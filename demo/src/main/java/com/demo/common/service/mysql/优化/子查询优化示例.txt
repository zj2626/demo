### 子查询优化示例 ###

mysql> EXPLAIN SELECT
	testb.ID,
	testb.AGE 
FROM
	testb,
	( SELECT ID, AGE FROM testa WHERE testa.AGE < 10000 ) test1 
WHERE
	test1.AGE = testb.AGE;
+----+-------------+-------+------------+-------+---------------+-------+---------+----------------+------+----------+--------------------------+
| id | select_type | table | partitions | type  | possible_keys | key   | key_len | ref            | rows | filtered | Extra                    |
+----+-------------+-------+------------+-------+---------------+-------+---------+----------------+------+----------+--------------------------+
|  1 | SIMPLE      | testa | NULL       | index | A_AGE         | A_AGE | 5       | NULL           | 4261 |   100.00 | Using where; Using index |
|  1 | SIMPLE      | testb | NULL       | ref   | B_AGE         | B_AGE | 5       | test.testa.AGE |    3 |   100.00 | Using index              |
+----+-------------+-------+------------+-------+---------------+-------+---------+----------------+------+----------+--------------------------+
2 rows in set (0.08 sec)

mysql> show warnings;
+-------+------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Level | Code | Message                                                                                                                                                                                                          |
+-------+------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Note  | 1003 | /* select#1 */ select `test`.`testb`.`ID` AS `ID`,`test`.`testb`.`AGE` AS `AGE` from `test`.`testb` join `test`.`testa` where ((`test`.`testb`.`AGE` = `test`.`testa`.`AGE`) and (`test`.`testa`.`AGE` < 10000)) |
+-------+------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
1 row in set (0.07 sec)


##############################################################################
##############################################################################
##############################################################################
##############################################################################

testa: 数据数量:2000w; 列: ID, Name, AGE; 索引:A_AGE(AGE), A_A(ID,AGE)
testb: 数据数量:440w ; 列: ID, Name, AGE; 索引:B_AGE(AGE), B_B(ID,AGE), B_NAME(NAME)

##############################################################################

>> IN子查询优化(相关子查询)

mysql> EXPLAIN SELECT
	testb.ID,
	testb.AGE
FROM
	testb
WHERE
	testb.AGE IN ( SELECT AGE FROM testa WHERE testa.ID > 1 AND testa.ID = testb.ID );
+----+-------------+-------+------------+--------+---------------+---------+---------+---------------+-------+----------+-------------+
| id | select_type | table | partitions | type   | possible_keys | key     | key_len | ref           | rows  | filtered | Extra       |
+----+-------------+-------+------------+--------+---------------+---------+---------+---------------+-------+----------+-------------+
|  1 | SIMPLE      | testb | NULL       | range  | PRIMARY,B_AGE | PRIMARY | 4       | NULL          | 50050 |   100.00 | Using where |
|  1 | SIMPLE      | testa | NULL       | eq_ref | PRIMARY,A_AGE | PRIMARY | 4       | test.testb.ID |     1 |     5.00 | Using where |
+----+-------------+-------+------------+--------+---------------+---------+---------+---------------+-------+----------+-------------+
2 rows in set (0.06 sec)

mysql> show warnings;
+-------+------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Level | Code | Message                                                                                                                                                                                                                                                     |
+-------+------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Note  | 1276 | Field or reference 'test.testb.ID' of SELECT #2 was resolved in SELECT #1                                                                                                                                                                                   |
| Note  | 1003 | /* select#1 */ select `test`.`testb`.`ID` AS `ID`,`test`.`testb`.`AGE` AS `AGE` from `test`.`testa` join `test`.`testb` where ((`test`.`testa`.`AGE` = `test`.`testb`.`AGE`) and (`test`.`testa`.`ID` = `test`.`testb`.`ID`) and (`test`.`testb`.`ID` > 1)) |
+-------+------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
2 rows in set (0.06 sec)

##############################################################################
##############################################################################

>> IN子查询优化(非相关子查询)

mysql> EXPLAIN SELECT
	testb.ID,
	testb.AGE 
FROM
	testb 
WHERE
	testb.AGE IN ( SELECT AGE FROM testa WHERE testa.ID > 1 );
+----+--------------+-------------+------------+--------+---------------+------------+---------+----------------+---------+----------+--------------------------+
| id | select_type  | table       | partitions | type   | possible_keys | key        | key_len | ref            | rows    | filtered | Extra                    |
+----+--------------+-------------+------------+--------+---------------+------------+---------+----------------+---------+----------+--------------------------+
|  1 | SIMPLE       | testb       | NULL       | index  | B_AGE         | B_AGE      | 5       | NULL           |  100101 |   100.00 | Using where; Using index |
|  1 | SIMPLE       | <subquery2> | NULL       | eq_ref | <auto_key>    | <auto_key> | 5       | test.testb.AGE |       1 |   100.00 | NULL                     |
|  2 | MATERIALIZED | testa       | NULL       | range  | PRIMARY,A_AGE | PRIMARY    | 4       | NULL           | 1001231 |   100.00 | Using where              |
+----+--------------+-------------+------------+--------+---------------+------------+---------+----------------+---------+----------+--------------------------+
3 rows in set (0.02 sec)

mysql> show warnings;
+-------+------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Level | Code | Message                                                                                                                                                                                                           |
+-------+------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Note  | 1003 | /* select#1 */ select `test`.`testb`.`ID` AS `ID`,`test`.`testb`.`AGE` AS `AGE` from `test`.`testb` semi join (`test`.`testa`) where ((`<subquery2>`.`AGE` = `test`.`testb`.`AGE`) and (`test`.`testa`.`ID` > 1)) |
+-------+------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
1 row in set (0.02 sec)

##############################################################################
##############################################################################

>> NOT IN子查询优化(非相关子查询)

mysql> EXPLAIN SELECT
	testb.ID,
	testb.AGE
FROM
	testb
WHERE
	testb.AGE NOT IN ( SELECT AGE FROM testa WHERE testa.ID > 1 );
+----+-------------+-------+------------+-------+---------------+---------+---------+------+---------+----------+--------------------------+
| id | select_type | table | partitions | type  | possible_keys | key     | key_len | ref  | rows    | filtered | Extra                    |
+----+-------------+-------+------------+-------+---------------+---------+---------+------+---------+----------+--------------------------+
|  1 | PRIMARY     | testb | NULL       | index | NULL          | B_AGE   | 5       | NULL |  100101 |   100.00 | Using where; Using index |
|  2 | SUBQUERY    | testa | NULL       | range | PRIMARY,A_AGE | PRIMARY | 4       | NULL | 1001231 |   100.00 | Using where              |
+----+-------------+-------+------------+-------+---------------+---------+---------+------+---------+----------+--------------------------+
2 rows in set (0.06 sec)

mysql> show warnings;
+-------+------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Level | Code | Message                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
+-------+------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Note  | 1003 | /* select#1 */ select `test`.`testb`.`ID` AS `ID`,`test`.`testb`.`AGE` AS `AGE` from `test`.`testb` where (not(<in_optimizer>(`test`.`testb`.`AGE`,`test`.`testb`.`AGE` in ( <materialize> (/* select#2 */ select `test`.`testa`.`AGE` from `test`.`testa` where (`test`.`testa`.`ID` > 1) having 1 ), <primary_index_lookup>(`test`.`testb`.`AGE` in <temporary table> on <auto_key> where ((`test`.`testb`.`AGE` = `materialized-subquery`.`AGE`))))))) |
+-------+------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
1 row in set (0.05 sec)

##############################################################################
##############################################################################

>> NOT IN子查询优化(相关子查询)

mysql> EXPLAIN SELECT
	testb.ID,
	testb.AGE
FROM
	testb
WHERE
	testb.AGE NOT IN ( SELECT AGE FROM testa WHERE testa.ID > 1 AND testb.ID = testb.ID );
+----+--------------------+-------+------------+----------------+---------------+-------+---------+------+--------+----------+-------------------------------------------------+
| id | select_type        | table | partitions | type           | possible_keys | key   | key_len | ref  | rows   | filtered | Extra                                           |
+----+--------------------+-------+------------+----------------+---------------+-------+---------+------+--------+----------+-------------------------------------------------+
|  1 | PRIMARY            | testb | NULL       | index          | NULL          | B_AGE | 5       | NULL | 100101 |   100.00 | Using where; Using index                        |
|  2 | DEPENDENT SUBQUERY | testa | NULL       | index_subquery | PRIMARY,A_AGE | A_AGE | 5       | func |   2666 |    50.00 | Using where; Using index; Full scan on NULL key |
+----+--------------------+-------+------------+----------------+---------------+-------+---------+------+--------+----------+-------------------------------------------------+
2 rows in set (0.06 sec)

mysql> show warnings;
+-------+------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Level | Code | Message                                                                                                                                                                                                                                                                                                                                                            |
+-------+------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Note  | 1276 | Field or reference 'test.testb.ID' of SELECT #2 was resolved in SELECT #1                                                                                                                                                                                                                                                                                          |
| Note  | 1276 | Field or reference 'test.testb.ID' of SELECT #2 was resolved in SELECT #1                                                                                                                                                                                                                                                                                          |
| Note  | 1003 | /* select#1 */ select `test`.`testb`.`ID` AS `ID`,`test`.`testb`.`AGE` AS `AGE` from `test`.`testb` where (not(<in_optimizer>(`test`.`testb`.`AGE`,<exists>(<index_lookup>(<cache>(`test`.`testb`.`AGE`) in testa on A_AGE checking NULL where (`test`.`testa`.`ID` > 1) having <if>(outer_field_is_not_null, <is_not_null_test>(`test`.`testa`.`AGE`), true)))))) |
+-------+------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
3 rows in set (0.05 sec)

##############################################################################
##############################################################################

>> EXISTS子查询优化(不支持)

mysql> EXPLAIN SELECT
	testb.ID,
	testb.AGE 
FROM
	testb 
WHERE
	EXISTS ( SELECT ID FROM testa WHERE testa.ID > 1 AND testa.AGE = testb.AGE );
+----+--------------------+-------+------------+-------+---------------+-------+---------+----------------+--------+----------+--------------------------+
| id | select_type        | table | partitions | type  | possible_keys | key   | key_len | ref            | rows   | filtered | Extra                    |
+----+--------------------+-------+------------+-------+---------------+-------+---------+----------------+--------+----------+--------------------------+
|  1 | PRIMARY            | testb | NULL       | index | NULL          | B_AGE | 5       | NULL           | 100101 |   100.00 | Using where; Using index |
|  2 | DEPENDENT SUBQUERY | testa | NULL       | ref   | PRIMARY,A_AGE | A_AGE | 5       | test.testb.AGE |   1333 |    50.00 | Using where; Using index |
+----+--------------------+-------+------------+-------+---------------+-------+---------+----------------+--------+----------+--------------------------+
2 rows in set (0.04 sec)

mysql> show warnings;
+-------+------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Level | Code | Message                                                                                                                                                                                                                                                             |
+-------+------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Note  | 1276 | Field or reference 'test.testb.AGE' of SELECT #2 was resolved in SELECT #1                                                                                                                                                                                          |
| Note  | 1003 | /* select#1 */ select `test`.`testb`.`ID` AS `ID`,`test`.`testb`.`AGE` AS `AGE` from `test`.`testb` where exists(/* select#2 */ select `test`.`testa`.`ID` from `test`.`testa` where ((`test`.`testa`.`ID` > 1) and (`test`.`testa`.`AGE` = `test`.`testb`.`AGE`))) |
+-------+------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
2 rows in set (0.04 sec)

##############################################################################
##############################################################################

>> IN子查询优化(非相关子查询)

mysql> EXPLAIN SELECT
	testa.ID,
	testa.AGE 
FROM
	testa 
WHERE
	testa.AGE IN ( SELECT AGE FROM testb WHERE testb.ID > 1 );
+----+-------------+-------+------------+-------+---------------+-------+---------+----------------+--------+----------+-------------------------------------+
| id | select_type | table | partitions | type  | possible_keys | key   | key_len | ref            | rows   | filtered | Extra                               |
+----+-------------+-------+------------+-------+---------------+-------+---------+----------------+--------+----------+-------------------------------------+
|  1 | SIMPLE      | testb | NULL       | index | PRIMARY,B_AGE | B_AGE | 5       | NULL           | 100101 |     0.54 | Using where; Using index; LooseScan |
|  1 | SIMPLE      | testa | NULL       | ref   | A_AGE         | A_AGE | 5       | test.testb.AGE |   1333 |   100.00 | Using index                         |
+----+-------------+-------+------------+-------+---------------+-------+---------+----------------+--------+----------+-------------------------------------+
2 rows in set (0.07 sec)

mysql> show warnings;
+-------+------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Level | Code | Message                                                                                                                                                                                                            |
+-------+------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Note  | 1003 | /* select#1 */ select `test`.`testa`.`ID` AS `ID`,`test`.`testa`.`AGE` AS `AGE` from `test`.`testa` semi join (`test`.`testb`) where ((`test`.`testa`.`AGE` = `test`.`testb`.`AGE`) and (`test`.`testb`.`ID` > 1)) |
+-------+------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
1 row in set (0.05 sec)

##############################################################################
##############################################################################

>> EXISTS子查询优化(不支持)

mysql> EXPLAIN SELECT
	testa.ID,
	testa.AGE 
FROM
	testa 
WHERE
	EXISTS ( SELECT ID FROM testb WHERE testb.ID > 1 AND testb.AGE = testa.AGE );
+----+--------------------+-------+------------+-------+---------------+-------+---------+----------------+---------+----------+--------------------------+
| id | select_type        | table | partitions | type  | possible_keys | key   | key_len | ref            | rows    | filtered | Extra                    |
+----+--------------------+-------+------------+-------+---------------+-------+---------+----------------+---------+----------+--------------------------+
|  1 | PRIMARY            | testa | NULL       | index | NULL          | A_AGE | 5       | NULL           | 2002462 |   100.00 | Using where; Using index |
|  2 | DEPENDENT SUBQUERY | testb | NULL       | ref   | PRIMARY,B_AGE | B_AGE | 5       | test.testa.AGE |     185 |    50.00 | Using where; Using index |
+----+--------------------+-------+------------+-------+---------------+-------+---------+----------------+---------+----------+--------------------------+
2 rows in set (0.07 sec)

mysql> show warnings;
+-------+------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Level | Code | Message                                                                                                                                                                                                                                                             |
+-------+------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Note  | 1276 | Field or reference 'test.testa.AGE' of SELECT #2 was resolved in SELECT #1                                                                                                                                                                                          |
| Note  | 1003 | /* select#1 */ select `test`.`testa`.`ID` AS `ID`,`test`.`testa`.`AGE` AS `AGE` from `test`.`testa` where exists(/* select#2 */ select `test`.`testb`.`ID` from `test`.`testb` where ((`test`.`testb`.`ID` > 1) and (`test`.`testb`.`AGE` = `test`.`testa`.`AGE`))) |
+-------+------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
2 rows in set (0.08 sec)


##############################################################################
##############################################################################

>> All子查询优化

mysql> EXPLAIN SELECT
	testb.ID,
	testb.AGE
FROM
	testb
WHERE
	testb.AGE > ALL ( SELECT AGE FROM testa WHERE testa.ID > 1 );
+----+-------------+-------+------------+-------+---------------+---------+---------+------+---------+----------+--------------------------+
| id | select_type | table | partitions | type  | possible_keys | key     | key_len | ref  | rows    | filtered | Extra                    |
+----+-------------+-------+------------+-------+---------------+---------+---------+------+---------+----------+--------------------------+
|  1 | PRIMARY     | testb | NULL       | index | NULL          | B_AGE   | 5       | NULL |  100101 |    66.67 | Using where; Using index |
|  2 | SUBQUERY    | testa | NULL       | range | PRIMARY       | PRIMARY | 4       | NULL | 1001231 |   100.00 | Using where              |
+----+-------------+-------+------------+-------+---------------+---------+---------+------+---------+----------+--------------------------+
2 rows in set (0.06 sec)

mysql> show warnings;
+-------+------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Level | Code | Message                                                                                                                                                                                                                                          |
+-------+------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Note  | 1003 | /* select#1 */ select `test`.`testb`.`ID` AS `ID`,`test`.`testb`.`AGE` AS `AGE` from `test`.`testb` where <not>((`test`.`testb`.`AGE` <= <max>(/* select#2 */ select `test`.`testa`.`AGE` from `test`.`testa` where (`test`.`testa`.`ID` > 1)))) |
+-------+------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
1 row in set (0.05 sec)

##############################################################################
##############################################################################

>> All子查询优化

mysql> EXPLAIN SELECT
	testb.ID,
	testb.AGE
FROM
	testb
WHERE
	testb.AGE <= ALL ( SELECT AGE FROM testa WHERE testa.ID > 1 );
+----+-------------+-------+------------+-------+---------------+---------+---------+------+---------+----------+--------------------------+
| id | select_type | table | partitions | type  | possible_keys | key     | key_len | ref  | rows    | filtered | Extra                    |
+----+-------------+-------+------------+-------+---------------+---------+---------+------+---------+----------+--------------------------+
|  1 | PRIMARY     | testb | NULL       | index | NULL          | B_AGE   | 5       | NULL |  100101 |    66.67 | Using where; Using index |
|  2 | SUBQUERY    | testa | NULL       | range | PRIMARY       | PRIMARY | 4       | NULL | 1001231 |   100.00 | Using where              |
+----+-------------+-------+------------+-------+---------------+---------+---------+------+---------+----------+--------------------------+
2 rows in set (0.06 sec)

mysql> show warnings;
+-------+------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Level | Code | Message                                                                                                                                                                                                                                         |
+-------+------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Note  | 1003 | /* select#1 */ select `test`.`testb`.`ID` AS `ID`,`test`.`testb`.`AGE` AS `AGE` from `test`.`testb` where <not>((`test`.`testb`.`AGE` > <min>(/* select#2 */ select `test`.`testa`.`AGE` from `test`.`testa` where (`test`.`testa`.`ID` > 1)))) |
+-------+------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
1 row in set (0.05 sec)

##############################################################################
##############################################################################

>> All子查询优化

mysql> EXPLAIN SELECT
	testb.ID,
	testb.AGE
FROM
	testb
WHERE
	testb.AGE = ALL ( SELECT AGE FROM testa WHERE testa.ID > 1 );
+----+--------------------+-------+------------+-------+---------------+---------+---------+------+---------+----------+--------------------------+
| id | select_type        | table | partitions | type  | possible_keys | key     | key_len | ref  | rows    | filtered | Extra                    |
+----+--------------------+-------+------------+-------+---------------+---------+---------+------+---------+----------+--------------------------+
|  1 | PRIMARY            | testb | NULL       | index | NULL          | B_AGE   | 5       | NULL |  100101 |   100.00 | Using where; Using index |
|  2 | DEPENDENT SUBQUERY | testa | NULL       | range | PRIMARY       | PRIMARY | 4       | NULL | 1001231 |   100.00 | Using where              |
+----+--------------------+-------+------------+-------+---------------+---------+---------+------+---------+----------+--------------------------+
2 rows in set (0.06 sec)

mysql> show warnings;
+-------+------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Level | Code | Message                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
+-------+------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Note  | 1003 | /* select#1 */ select `test`.`testb`.`ID` AS `ID`,`test`.`testb`.`AGE` AS `AGE` from `test`.`testb` where <not>(<in_optimizer>(`test`.`testb`.`AGE`,<exists>(/* select#2 */ select 1 from `test`.`testa` where ((`test`.`testa`.`ID` > 1) and <if>(outer_field_is_not_null, ((<cache>(`test`.`testb`.`AGE`) <> `test`.`testa`.`AGE`) or isnull(`test`.`testa`.`AGE`)), true)) having <if>(outer_field_is_not_null, <is_not_null_test>(`test`.`testa`.`AGE`), true)))) |
+-------+------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
1 row in set (0.05 sec)

##############################################################################
##############################################################################

>> SOME子查询优化(ANY同理)

mysql> EXPLAIN SELECT
	testb.ID,
	testb.AGE
FROM
	testb
WHERE
	testb.AGE > SOME ( SELECT AGE FROM testa WHERE testa.ID > 1 );
+----+-------------+-------+------------+-------+---------------+---------+---------+------+---------+----------+--------------------------+
| id | select_type | table | partitions | type  | possible_keys | key     | key_len | ref  | rows    | filtered | Extra                    |
+----+-------------+-------+------------+-------+---------------+---------+---------+------+---------+----------+--------------------------+
|  1 | PRIMARY     | testb | NULL       | index | NULL          | B_AGE   | 5       | NULL |  100101 |    66.67 | Using where; Using index |
|  2 | SUBQUERY    | testa | NULL       | range | PRIMARY       | PRIMARY | 4       | NULL | 1001231 |   100.00 | Using where              |
+----+-------------+-------+------------+-------+---------------+---------+---------+------+---------+----------+--------------------------+
2 rows in set (0.06 sec)

mysql> show warnings;
+-------+------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Level | Code | Message                                                                                                                                                                                                                                         |
+-------+------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Note  | 1003 | /* select#1 */ select `test`.`testb`.`ID` AS `ID`,`test`.`testb`.`AGE` AS `AGE` from `test`.`testb` where <nop>((`test`.`testb`.`AGE` > (/* select#2 */ select min(`test`.`testa`.`AGE`) from `test`.`testa` where (`test`.`testa`.`ID` > 1)))) |
+-------+------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
1 row in set (0.04 sec)

##############################################################################
##############################################################################

>> SOME子查询优化(ANY同理)

mysql> EXPLAIN SELECT
	testb.ID,
	testb.AGE
FROM
	testb
WHERE
	testb.AGE = SOME ( SELECT AGE FROM testa WHERE testa.ID > 1 );
+----+--------------+-------------+------------+--------+---------------+------------+---------+----------------+---------+----------+--------------------------+
| id | select_type  | table       | partitions | type   | possible_keys | key        | key_len | ref            | rows    | filtered | Extra                    |
+----+--------------+-------------+------------+--------+---------------+------------+---------+----------------+---------+----------+--------------------------+
|  1 | SIMPLE       | testb       | NULL       | index  | B_AGE         | B_AGE      | 5       | NULL           |  100101 |   100.00 | Using where; Using index |
|  1 | SIMPLE       | <subquery2> | NULL       | eq_ref | <auto_key>    | <auto_key> | 5       | test.testb.AGE |       1 |   100.00 | NULL                     |
|  2 | MATERIALIZED | testa       | NULL       | range  | PRIMARY,A_AGE | PRIMARY    | 4       | NULL           | 1001231 |   100.00 | Using where              |
+----+--------------+-------------+------------+--------+---------------+------------+---------+----------------+---------+----------+--------------------------+
3 rows in set (0.04 sec)

mysql> show warnings;
+-------+------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Level | Code | Message                                                                                                                                                                                                           |
+-------+------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Note  | 1003 | /* select#1 */ select `test`.`testb`.`ID` AS `ID`,`test`.`testb`.`AGE` AS `AGE` from `test`.`testb` semi join (`test`.`testa`) where ((`<subquery2>`.`AGE` = `test`.`testb`.`AGE`) and (`test`.`testa`.`ID` > 1)) |
+-------+------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
1 row in set (0.04 sec)

##############################################################################
##############################################################################